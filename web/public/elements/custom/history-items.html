<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="/elements/custom/app-theme.html">
<dom-module id="history-items">
  <template>
    <style include="app-theme">
       :host {
        display: block;
      }
      
      p.selected-day {
        display: block;
        text-align: center;
        color: #333;
      }
      
      .date-container {
        display: block;
        text-align: center;
      }
      
      paper-material {
        margin: 3px 3px;
        display: inline-block;
        background-color: white;
      }
      
      .container {
        display: flex;
        flex-flow: row;
        align-items: flex-start;
      }
      
      day-items {
        flex-grow: 1;
      }

      .date-selector {
        text-align: center;
        padding: 10px;
      }
      
      @media all and (max-width: 1100px) {
        .container {
          flex-flow: column;
          justify-content: center;
          align-items: stretch;
        }
      }
    </style>
    <div class="container">
      <div class="date-selector">
        <paper-material elevation="1">
          <paper-date-picker date="[[date]]" on-date-changed="_dateChanged"></paper-date-picker>
        </paper-material>
      </div>
      <day-items day-as-string="[[dayAsString]]" book-id="[[bookId]]"></day-items>
    </div>
    <!-- <div class="date-container">
      <paper-material elevation="1">
        <paper-date-picker date="[[date]]" on-date-changed="_dateChanged"></paper-date-picker>
      </paper-material>
    </div>
   -->


  </template>
  <script>
    Polymer({
      is: 'history-items',
      properties: {
        dayAsString: {
          type: String,
          value: '',
        },
        date: {
          type: Date,
          value: function () {
            var date = new Date();
            return this._addDays(date, -1);
          }
        },
        todayAsString: {
          type: String,
          value: '',
        },
        bookId: {
          type: String,
          value: '',
        },
      },
      ready: function () {
        this._selectDate(this.date);
      },
      _dateChanged: function (ev) {
        if (this.dayAsString !== '') {
          console.log('_dateChanged', ev.detail.value);
          this._selectDate(new Date(ev.detail.value));
        }

      },
      _selectDate: function (date) {
        if (this.dayAsString === '' || this._dateToInt(this.date) != this._dateToInt(date)) {
          this.date = new Date(date);
          this.dayAsString = this._dateToInt(date).toString();
        }
      },
      _addDays: function (date, days) {
        var result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
      },
      _dateToInt: function (date) {
        if (!date) return 0;
        var result = date.getFullYear().toString();
        if (date.getMonth() + 1 < 10) result += "0";
        result += (date.getMonth() + 1).toString();
        if (date.getDate() < 10) result += "0";
        result += date.getDate().toString();
        return result;
      },
    });
  </script>
</dom-module>